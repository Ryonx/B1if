<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet xmlns:b1e="urn:com.sap.b1i.sim:b1event" xmlns:b1ie="urn:com.sap.b1i.sim:b1ievent" xmlns:bfa="urn:com.sap.b1i.bizprocessor:bizatoms" xmlns:jdbc="urn:com.sap.b1i.adapter:jdbcadapter" xmlns:r3="urn:sap-com:document:sap:rfc:functions" xmlns:vpf="urn:com.sap.b1i.vplatform:entity" xmlns:xci="urn:com.sap.b1i.xcellerator:intdoc" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0" bfa:force="" xsi:force="" vpf:force="" xci:force="" b1ie:force="" b1e:force="" jdbc:force="" r3:force=""><xsl:variable name="ts" select="document(&apos;/com.sap.b1i.internal/xml/timestamp&apos;)"></xsl:variable><xsl:variable name="today" select="concat($ts/bfa:timestamp/@year,&apos;-&apos;,$ts/bfa:timestamp/@month,&apos;-&apos;,$ts/bfa:timestamp/@date)"></xsl:variable><xsl:variable name="now" select="concat($ts/bfa:timestamp/@hour,$ts/bfa:timestamp/@minute)"></xsl:variable><xsl:variable name="Fnow" select="concat($ts/bfa:timestamp/@hour,&apos;:&apos;,$ts/bfa:timestamp/@minute,&apos;:&apos;,$ts/bfa:timestamp/@second)"></xsl:variable><xsl:variable name="SIDid" select="/vpf:Msg/vpf:Header/vpf:vBIU/@SId"></xsl:variable><xsl:variable name="SIDdoc" select="document(concat(&apos;/com.sap.b1i.vplatform.scenarios.design/vPac.&apos;,$SIDid,&apos;/vPac.xml&apos;))"></xsl:variable><xsl:variable name="auth" select="substring-before(substring-after($SIDdoc/vpf:vPac/@Authentication,&apos;(&apos;),&apos;)&apos;)"></xsl:variable><xsl:variable name="userid"><xsl:choose><xsl:when test="/vpf:Msg/@test=&apos;true&apos;"><xsl:value-of select="/vpf:Msg/vpf:Header/vpf:Variables/vpf:var[./@id=&apos;userid&apos;]/@value"></xsl:value-of></xsl:when><xsl:when test="string-length($auth)=0">no_authentication</xsl:when><xsl:otherwise><xsl:variable name="AUTdoc" select="document(&apos;/com.sap.b1i.internal.xc/xml/sessioninfo.xml&apos;)"></xsl:variable><xsl:value-of select="$AUTdoc/xci:session-info/xci:key[./@name=&apos;usrid&apos;]/@value"></xsl:value-of></xsl:otherwise></xsl:choose></xsl:variable><xsl:variable name="username"><xsl:choose><xsl:when test="/vpf:Msg/@test=&apos;true&apos;"><xsl:value-of select="/vpf:Msg/vpf:Header/vpf:Variables/vpf:var[./@id=&apos;username&apos;]/@value"></xsl:value-of></xsl:when><xsl:when test="string-length($auth)=0">no_authentication</xsl:when><xsl:otherwise><xsl:variable name="AUTdoc" select="document(&apos;/com.sap.b1i.internal.xc/xml/sessioninfo.xml&apos;)"></xsl:variable><xsl:value-of select="$AUTdoc/xci:session-info/xci:key[./@name=&apos;user&apos;]/@value"></xsl:value-of></xsl:otherwise></xsl:choose></xsl:variable><xsl:template match="/"><Msg xmlns="urn:com.sap.b1i.vplatform:entity"><xsl:copy-of select="/vpf:Msg/@*"></xsl:copy-of><Header><xsl:copy-of select="/vpf:Msg/vpf:Header/*[not(contains(&apos;vBIU,Variables,Properties,VarProperties&apos;,local-name()))]"></xsl:copy-of><vBIU><xsl:attribute name="Id"><xsl:value-of select="/vpf:Msg/vpf:Header/vpf:vBIU/@Id"></xsl:value-of></xsl:attribute><xsl:attribute name="ver">1.0.0</xsl:attribute><xsl:attribute name="SId"><xsl:value-of select="/vpf:Msg/vpf:Header/vpf:vBIU/@SId"></xsl:value-of></xsl:attribute><xsl:attribute name="filter"><xsl:value-of select="/vpf:Msg/vpf:Header/vpf:vBIU/@filter"></xsl:value-of></xsl:attribute><xsl:attribute name="phase"><xsl:value-of select="/vpf:Msg/vpf:Header/vpf:vBIU/@phase"></xsl:value-of></xsl:attribute></vBIU><Variables><var id="userid"><xsl:attribute name="value"><xsl:value-of select="$userid"></xsl:value-of></xsl:attribute></var><var id="username"><xsl:attribute name="value"><xsl:value-of select="$username"></xsl:value-of></xsl:attribute></var></Variables><Properties></Properties><VarProperties></VarProperties></Header><xsl:copy-of select="/vpf:Msg/vpf:Body"></xsl:copy-of></Msg></xsl:template><xsl:include href="../../com.sap.b1i.system.lib/xsl/string.xsl"></xsl:include></xsl:stylesheet>